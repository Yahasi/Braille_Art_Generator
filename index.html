<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Braille ASCII Art Generator</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#083826;
      --bg2:#0e4d35;
      --card:#0b3b2e;
      --accent:#22c55e;
      --muted:#a7e9c9;
      color-scheme: dark;
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:linear-gradient(180deg,var(--bg) 0%, var(--bg2) 100%);color:#e6fff3}
    /* ещё меньше отступов слева/справа */
    .wrap{max-width:1300px;margin:6px auto;padding:2px}
    .card-app{background:rgba(255,255,255,0.03);border-radius:12px;padding:14px;box-shadow:0 6px 30px rgba(2,6,23,0.45)}
    h1{font-size:20px;margin-bottom:10px}
    label.small{font-size:13px;color:var(--muted)}
    .controls .form-control, .controls .form-select {background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}
    .btn-primary{background:var(--accent);border-color:var(--accent)}
    canvas{background:#fff;border-radius:6px;max-width:100%;height:auto;display:block}
    pre.output{white-space:pre;overflow:auto;padding:12px;border-radius:8px;background:rgba(0,18,10,0.9);color:#e6fff3;font-family:monospace;line-height:0.95;min-height:160px;max-height:700px}
    .small-muted{font-size:12px;color:var(--muted)}
    .preview-stack canvas{border:1px solid rgba(255,255,255,0.05);}
    .val-box{width:56px;text-align:center}
    @media(max-width:767.98px){
      .wrap{padding:4px}
      .card-app{padding:10px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card-app">
      <h1>Braille ASCII Art Generator — client-side</h1>

      <div class="row gx-3">
        <!-- LEFT: controls -->
        <div class="col-12 col-md-5">
          <div class="mb-3">
            <label class="small">Загрузить изображение</label>
            <input id="file" class="form-control form-control-sm" type="file" accept="image/*">
          </div>

          <div class="controls">
            <div class="row g-2 mb-2">
              <div class="col-6">
                <label class="small">Ширина в символах</label>
                <input id="outWidth" type="number" class="form-control form-control-sm" min="1" value="80">
              </div>
              <div class="col-6">
                <label class="small">Высота в символах</label>
                <input id="outHeight" type="number" class="form-control form-control-sm" min="1" value="30">
              </div>
            </div>

            <div class="row g-2 mb-2 align-items-center">
              <div class="col-6">
                <div class="form-check">
                  <input id="keepAspect" class="form-check-input" type="checkbox" checked>
                  <label class="form-check-label small-muted" for="keepAspect">Сохранить соотношение</label>
                </div>
              </div>
              <div class="col-6">
                <label class="small">Размер шрифта (px)</label>
                <input id="fontSize" type="number" class="form-control form-control-sm" min="6" max="48" value="12">
              </div>
            </div>

            <div class="mb-2">
              <label class="small">Порог (threshold) 0..255</label>
              <div class="d-flex align-items-center gap-2">
                <input id="threshold" type="range" class="form-range" min="0" max="255" value="128" style="flex:1">
                <div id="thresholdVal" class="small-muted val-box">128</div>
              </div>
            </div>

            <div class="mb-3">
              <label class="small">Инвертировать</label>
              <select id="invert" class="form-select form-select-sm">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>

            <hr style="border-color:rgba(255,255,255,0.03)" />
            <div class="mb-2">
              <label class="small">Яркость (brightness)</label>
              <div class="d-flex align-items-center gap-2">
                <input id="brightness" type="range" class="form-range" min="-100" max="100" value="0" style="flex:1">
                <div id="brightnessVal" class="small-muted val-box">0</div>
              </div>
            </div>
            <div class="mb-2">
              <label class="small">Контраст (contrast)</label>
              <div class="d-flex align-items-center gap-2">
                <input id="contrast" type="range" class="form-range" min="-100" max="100" value="0" style="flex:1">
                <div id="contrastVal" class="small-muted val-box">0</div>
              </div>
            </div>
            <div class="mb-2">
              <label class="small">Насыщенность (saturation)</label>
              <div class="d-flex align-items-center gap-2">
                <input id="saturation" type="range" class="form-range" min="-100" max="100" value="0" style="flex:1">
                <div id="saturationVal" class="small-muted val-box">0</div>
              </div>
            </div>
            <div class="mb-2">
              <label class="small">Резкость (sharpness)</label>
              <div class="d-flex align-items-center gap-2">
                <input id="sharpness" type="range" class="form-range" min="0" max="5" step="0.1" value="0" style="flex:1">
                <div id="sharpnessVal" class="small-muted val-box">0.0</div>
              </div>
            </div>

            <div class="d-flex gap-2 flex-wrap mb-2 mt-2">
              <button id="generate" class="btn btn-primary btn-sm">Сгенерировать</button>
              <button id="downloadTxt" class="btn btn-outline-light btn-sm">Скачать .txt</button>
              <button id="copy" class="btn btn-outline-light btn-sm">Копировать</button>
              <button id="downloadPng" class="btn btn-outline-light btn-sm">Скачать PNG</button>
            </div>

            <div class="d-flex gap-2 mt-1">
              <button id="resetEdits" class="btn btn-sm btn-secondary">Сбросить редактирование</button>
            </div>

            <div class="small-muted mt-2">Подсказка: каждый символ braille кодирует блок 2×4 пикселя. Редактируйте изображение слева — редакция применяется на правый (редактируемый) холст.</div>
          </div>
        </div>

        <!-- RIGHT: previews and output (vertical stack) -->
        <div class="col-12 col-md-7">
          <div class="d-flex flex-column gap-3 preview-stack">
            <div>
              <label class="small">Исходное изображение (preview)</label>
              <canvas id="srcCanvas" width="360" height="240"></canvas>
            </div>

            <div>
              <label class="small">Редактируемое изображение (отсюда будет генерироваться Braille)</label>
              <canvas id="editCanvas" width="720" height="480"></canvas>
            </div>

            <div>
              <label class="small">Масштабированный холст (для предпросмотра перед генерацией)</label>
              <canvas id="resCanvas" width="360" height="240"></canvas>
            </div>

            <div>
              <label class="small">Результат (текст с символами Braille)</label>
              <pre id="output" class="output" contenteditable></pre>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-3 small-muted">Работает полностью на клиенте — можно заливать на GitHub Pages (github.io). Ограничения: нет multi-threading на github.io.</div>
    </div>
  </div>

  <!-- Подключаем JS: ваш внешний скрипт (оставьте рядом в репозитории) -->
  <script src="braille-generator.js"></script>

  <!-- Дополнительный скрипт для отображения значений и кнопки сброса -->
  <script>
    (function(){
      function $(id){return document.getElementById(id)}
      const pairs = [
        ['brightness','brightnessVal', '0'],
        ['contrast','contrastVal', '0'],
        ['saturation','saturationVal', '0'],
        ['sharpness','sharpnessVal', '0.0']
      ];
      pairs.forEach(([rangeId,valId,def])=>{
        const r = $(rangeId), v = $(valId);
        if(!r || !v) return;
        const fmt = rangeId === 'sharpness' ? (x=>parseFloat(x).toFixed(1)) : (x=>parseInt(x));
        v.textContent = fmt(r.value);
        r.addEventListener('input', ()=>{ v.textContent = fmt(r.value); });
      });

      // threshold already handled in main script, but ensure display exists
      const th = $('threshold'); const thv = $('thresholdVal');
      if(th && thv){ thv.textContent = th.value; th.addEventListener('input', ()=> thv.textContent = th.value); }

      // reset button: set all ranges to defaults and dispatch input events so main script applies changes
      const reset = $('resetEdits');
      if(reset){
        reset.addEventListener('click', ()=>{
          pairs.forEach(([rangeId,valId,def])=>{
            const r = $(rangeId); const v = $(valId);
            if(!r || !v) return;
            r.value = def;
            // update displayed value
            v.textContent = (rangeId === 'sharpness') ? parseFloat(def).toFixed(1) : parseInt(def);
            // dispatch input event so main script applies adjustments
            r.dispatchEvent(new Event('input', {bubbles:true}));
          });
        });
      }
    })();
  </script>

  <!-- Подключение Bootstrap JS (если понадобится, необязательно) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>